<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="2333" height="738" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Title: Dubbo协议+Netty4传输，服务激活
InvokerInvocationHandler->MockClusterInvoker: invoke
MockClusterInvoker->AbstractClusterInvoker: invoke
AbstractClusterInvoker-->RegistryDirectory: doList
Note over RegistryDirectory: 从RegistryDirectory缓存的映射表中获取Invoker列表
Note over AbstractClusterInvoker: 获取负载均衡器
AbstractClusterInvoker->FailoverClusterInvoker: doInvoke
Note over FailoverClusterInvoker: 执行请求失败策略
FailoverClusterInvoker->InvokerDelegete: invoke
InvokerDelegete->ProtocolFilterWrapper.Invoker: invoke
Note over ProtocolFilterWrapper.Invoker: ConsumerContextFilter-FutureFilter-MonitorFilter
ProtocolFilterWrapper.Invoker->DubboInvoker: invoke
DubboInvoker->HeaderExchangeClient: request
HeaderExchangeClient->HeaderExchangeChannel: request
HeaderExchangeChannel->NettyChannel: send
DubboInvoker->ResponseFuture: get（同步请求情况下）]]></source><desc>Dubbo协议+Netty4传输，服务激活</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"><rect x="10" y="10" width="250" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="15" y="29" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">Dubbo协议+Netty4传输，服务激活</tspan></text></g><g class="actor"><rect x="10" y="46" width="212" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">InvokerInvocationHandler</tspan></text></g><g class="actor"><rect x="10" y="682" width="212" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">InvokerInvocationHandler</tspan></text></g><line x1="116" x2="116" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="242" y="46" width="164" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="252" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="252">MockClusterInvoker</tspan></text></g><g class="actor"><rect x="242" y="682" width="164" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="252" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="252">MockClusterInvoker</tspan></text></g><line x1="324" x2="324" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="426" y="46" width="196" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="436" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="436">AbstractClusterInvoker</tspan></text></g><g class="actor"><rect x="426" y="682" width="196" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="436" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="436">AbstractClusterInvoker</tspan></text></g><line x1="524" x2="524" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="653" y="46" width="156" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="663" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="663">RegistryDirectory</tspan></text></g><g class="actor"><rect x="653" y="682" width="156" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="663" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="663">RegistryDirectory</tspan></text></g><line x1="731" x2="731" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="840" y="46" width="196" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="850" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="850">FailoverClusterInvoker</tspan></text></g><g class="actor"><rect x="840" y="682" width="196" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="850" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="850">FailoverClusterInvoker</tspan></text></g><line x1="938" x2="938" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1056" y="46" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1066" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1066">InvokerDelegete</tspan></text></g><g class="actor"><rect x="1056" y="682" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1066" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1066">InvokerDelegete</tspan></text></g><line x1="1126" x2="1126" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1216" y="46" width="252" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1226" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1226">ProtocolFilterWrapper.Invoker</tspan></text></g><g class="actor"><rect x="1216" y="682" width="252" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1226" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1226">ProtocolFilterWrapper.Invoker</tspan></text></g><line x1="1342" x2="1342" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1491" y="46" width="116" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1501" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1501">DubboInvoker</tspan></text></g><g class="actor"><rect x="1491" y="682" width="116" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1501" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1501">DubboInvoker</tspan></text></g><line x1="1549" x2="1549" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1627" y="46" width="180" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1637" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1637">HeaderExchangeClient</tspan></text></g><g class="actor"><rect x="1627" y="682" width="180" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1637" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1637">HeaderExchangeClient</tspan></text></g><line x1="1717" x2="1717" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1827" y="46" width="188" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1837" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1837">HeaderExchangeChannel</tspan></text></g><g class="actor"><rect x="1827" y="682" width="188" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1837" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1837">HeaderExchangeChannel</tspan></text></g><line x1="1921" x2="1921" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2035" y="46" width="116" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2045" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2045">NettyChannel</tspan></text></g><g class="actor"><rect x="2035" y="682" width="116" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2045" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2045">NettyChannel</tspan></text></g><line x1="2093" x2="2093" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2171" y="46" width="132" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2181" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2181">ResponseFuture</tspan></text></g><g class="actor"><rect x="2171" y="682" width="132" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2181" y="706" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2181">ResponseFuture</tspan></text></g><line x1="2237" x2="2237" y1="82" y2="682" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="signal"><text x="196" y="113" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="196">invoke</tspan></text><line x1="116" x2="324" y1="118" y2="118" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="400" y="149" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="400">invoke</tspan></text><line x1="324" x2="524" y1="154" y2="154" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="603.5" y="185" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="603.5">doList</tspan></text><line x1="524" x2="731" y1="190" y2="190" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="534" y="210" width="394" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="539" y="229" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="539">从RegistryDirectory缓存的映射表中获取Invoker列表</tspan></text></g><g class="note"><rect x="463" y="256" width="122" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="468" y="275" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="468">获取负载均衡器</tspan></text></g><g class="signal"><text x="699" y="313" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="699">doInvoke</tspan></text><line x1="524" x2="938" y1="318" y2="318" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="869" y="338" width="138" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="874" y="357" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="874">执行请求失败策略</tspan></text></g><g class="signal"><text x="1008" y="395" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1008">invoke</tspan></text><line x1="938" x2="1126" y1="400" y2="400" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1210" y="431" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1210">invoke</tspan></text><line x1="1126" x2="1342" y1="436" y2="436" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="1145" y="456" width="394" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1150" y="475" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1150">ConsumerContextFilter-FutureFilter-MonitorFilter</tspan></text></g><g class="signal"><text x="1421.5" y="513" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1421.5">invoke</tspan></text><line x1="1342" x2="1549" y1="518" y2="518" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1605" y="549" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1605">request</tspan></text><line x1="1549" x2="1717" y1="554" y2="554" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1791" y="585" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1791">request</tspan></text><line x1="1717" x2="1921" y1="590" y2="590" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1991" y="621" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1991">send</tspan></text><line x1="1921" x2="2093" y1="626" y2="626" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1809" y="657" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1809">get（同步请求情况下）</tspan></text><line x1="1549" x2="2237" y1="662" y2="662" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g></svg>