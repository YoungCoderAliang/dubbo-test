<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="3268" height="1697" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Title: Dubbo协议+Netty4传输，服务引用
DubboNamespaceHandler-->DubboBeanDefinitionParser: add
DubboBeanDefinitionParser-->ReferenceBean: register
Note over DubboBeanDefinitionParser,ReferenceBean: 增加 dubbo:reference 标签\n解析器与工厂类
ReferenceBean->ReferenceBean: getObject
ReferenceBean->ReferenceConfig: init
Note over ReferenceConfig: 处理各种配置信息\n如果不配置直连模式，那么在reference配置中\n是没有具体的通信协议的，需要去注册中心查询\n所以会将协议设置成registry，应用扩展机制\n通过RegistryProtocol去注册中心查询并触发通道建立 
ReferenceConfig->RegistryProtocol: refer
Note over ReferenceConfig,RegistryProtocol: 由dubbo扩展机制wrapper机制\nProtocolFilterWrapper和\nProtocolListenerWrapper装饰
RegistryProtocol->RegistryProtocol: doRefer
RegistryProtocol->RegistryDirectory: subscribe
RegistryDirectory->FailbackRegistry: subscribe
FailbackRegistry->ZookeeperRegistry: doSubscribe
Note over ZookeeperRegistry: 在ZookeeperRegistry会监听注册中心变化\n并在此时返回注册中心已有的数据
ZookeeperRegistry-->RegistryDirectory: refreshInvoker
Note over RegistryDirectory: 经过若干调用后，刷新RegistryDirectory\n中缓存的Invoker映射表\n这个映射表也是后续查找服务者的基础
RegistryDirectory->RegistryDirectory: toInvokers
RegistryDirectory-->DubboProtocol: refer
Note over RegistryDirectory,DubboProtocol: 由dubbo扩展机制wrapper机制\nProtocolFilterWrapper和\nProtocolListenerWrapper装饰\n并构造Filter执行链
DubboProtocol->DubboProtocol: initClient
DubboProtocol->Exchangers: connect
Exchangers->HeaderExchanger: connect
HeaderExchanger->Transporters: connect
Transporters->NettyTransporter: connect
NettyTransporter->NettyClient: NettyClient
NettyClient->ChannelHandlers: wrapInternal
Note over NettyClient,ChannelHandlers: 初始化响应处理过程
NettyClient->NettyClient: doOpen
NettyClient->NettyClient: doConnect
RegistryProtocol->Cluster$Adapter: join
Note over RegistryProtocol: RegistryDirectory缓存Invoker列表\nCluster$Adapter返回一个调度Invoker列表的Invoker装饰\nCluster也有wrapper实现：MockClusterWrapper\n因此最终的包裹关系是MockClusterInvoker-AbstractClusterInvoker
ReferenceConfig->JdkProxyFactory: getProxy
JdkProxyFactory->InvokerInvocationHandler: add InvokeHandler]]></source><desc>Dubbo协议+Netty4传输，服务引用</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"><rect x="10" y="10" width="250" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="15" y="29" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">Dubbo协议+Netty4传输，服务引用</tspan></text></g><g class="actor"><rect x="10" y="46" width="188" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">DubboNamespaceHandler</tspan></text></g><g class="actor"><rect x="10" y="1641.140625" width="188" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">DubboNamespaceHandler</tspan></text></g><line x1="104" x2="104" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="218" y="46" width="220" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="228" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="228">DubboBeanDefinitionParser</tspan></text></g><g class="actor"><rect x="218" y="1641.140625" width="220" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="228" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="228">DubboBeanDefinitionParser</tspan></text></g><line x1="328" x2="328" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="458" y="46" width="124" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="468" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="468">ReferenceBean</tspan></text></g><g class="actor"><rect x="458" y="1641.140625" width="124" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="468" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="468">ReferenceBean</tspan></text></g><line x1="520" x2="520" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="657" y="46" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="667" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="667">ReferenceConfig</tspan></text></g><g class="actor"><rect x="657" y="1641.140625" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="667" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="667">ReferenceConfig</tspan></text></g><line x1="727" x2="727" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="912" y="46" width="148" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="922" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="922">RegistryProtocol</tspan></text></g><g class="actor"><rect x="912" y="1641.140625" width="148" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="922" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="922">RegistryProtocol</tspan></text></g><line x1="986" x2="986" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1167" y="46" width="156" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1177" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1177">RegistryDirectory</tspan></text></g><g class="actor"><rect x="1167" y="1641.140625" width="156" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1177" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1177">RegistryDirectory</tspan></text></g><line x1="1245" x2="1245" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1343" y="46" width="148" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1353" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1353">FailbackRegistry</tspan></text></g><g class="actor"><rect x="1343" y="1641.140625" width="148" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1353" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1353">FailbackRegistry</tspan></text></g><line x1="1417" x2="1417" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1511" y="46" width="156" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1521" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1521">ZookeeperRegistry</tspan></text></g><g class="actor"><rect x="1511" y="1641.140625" width="156" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1521" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1521">ZookeeperRegistry</tspan></text></g><line x1="1589" x2="1589" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1690" y="46" width="124" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1700" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1700">DubboProtocol</tspan></text></g><g class="actor"><rect x="1690" y="1641.140625" width="124" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1700" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1700">DubboProtocol</tspan></text></g><line x1="1752" x2="1752" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1834" y="46" width="100" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1844" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1844">Exchangers</tspan></text></g><g class="actor"><rect x="1834" y="1641.140625" width="100" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1844" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1844">Exchangers</tspan></text></g><line x1="1884" x2="1884" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="1954" y="46" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1964" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1964">HeaderExchanger</tspan></text></g><g class="actor"><rect x="1954" y="1641.140625" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1964" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1964">HeaderExchanger</tspan></text></g><line x1="2024" x2="2024" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2114" y="46" width="116" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2124" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2124">Transporters</tspan></text></g><g class="actor"><rect x="2114" y="1641.140625" width="116" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2124" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2124">Transporters</tspan></text></g><line x1="2172" x2="2172" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2250" y="46" width="148" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2260" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2260">NettyTransporter</tspan></text></g><g class="actor"><rect x="2250" y="1641.140625" width="148" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2260" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2260">NettyTransporter</tspan></text></g><line x1="2324" x2="2324" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2418" y="46" width="108" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2428" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2428">NettyClient</tspan></text></g><g class="actor"><rect x="2418" y="1641.140625" width="108" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2428" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2428">NettyClient</tspan></text></g><line x1="2472" x2="2472" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2546" y="46" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2556" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2556">ChannelHandlers</tspan></text></g><g class="actor"><rect x="2546" y="1641.140625" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2556" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2556">ChannelHandlers</tspan></text></g><line x1="2616" x2="2616" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2706" y="46" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2716" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2716">Cluster$Adapter</tspan></text></g><g class="actor"><rect x="2706" y="1641.140625" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2716" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2716">Cluster$Adapter</tspan></text></g><line x1="2776" x2="2776" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="2866" y="46" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2876" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2876">JdkProxyFactory</tspan></text></g><g class="actor"><rect x="2866" y="1641.140625" width="140" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2876" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2876">JdkProxyFactory</tspan></text></g><line x1="2936" x2="2936" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="3026" y="46" width="212" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="3036" y="70" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="3036">InvokerInvocationHandler</tspan></text></g><g class="actor"><rect x="3026" y="1641.140625" width="212" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="3036" y="1665.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="3036">InvokerInvocationHandler</tspan></text></g><line x1="3132" x2="3132" y1="82" y2="1641.140625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="signal"><text x="204" y="113" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="204">add</tspan></text><line x1="104" x2="328" y1="118" y2="118" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="392" y="149" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="392">register</tspan></text><line x1="328" x2="520" y1="154" y2="154" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="318" y="174" width="212" height="45.1875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="323" y="193" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="323">增加 dubbo:reference 标签</tspan><tspan dy="1.2em" x="323">解析器与工厂类</tspan></text></g><g class="signal"><text x="545" y="252.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="545">getObject</tspan></text><line x1="520" x2="540" y1="239.1875" y2="239.1875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="540" x2="540" y1="239.1875" y2="260.1875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="540" x2="520" y1="260.1875" y2="260.1875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="607.5" y="286.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="607.5">init</tspan></text><line x1="520" x2="727" y1="291.1875" y2="291.1875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="530" y="311.1875" width="394" height="102.796875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="535" y="330.1875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="535">处理各种配置信息</tspan><tspan dy="1.2em" x="535">如果不配置直连模式，那么在reference配置中</tspan><tspan dy="1.2em" x="535">是没有具体的通信协议的，需要去注册中心查询</tspan><tspan dy="1.2em" x="535">所以会将协议设置成registry，应用扩展机制</tspan><tspan dy="1.2em" x="535">通过RegistryProtocol去注册中心查询并触发通道建立</tspan></text></g><g class="signal"><text x="836.5" y="444.984375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="836.5">refer</tspan></text><line x1="727" x2="986" y1="449.984375" y2="449.984375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="717" y="469.984375" width="279" height="64.390625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="722" y="488.984375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="722">由dubbo扩展机制wrapper机制</tspan><tspan dy="1.2em" x="722">ProtocolFilterWrapper和</tspan><tspan dy="1.2em" x="722">ProtocolListenerWrapper装饰</tspan></text></g><g class="signal"><text x="1011" y="567.375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1011">doRefer</tspan></text><line x1="986" x2="1006" y1="554.375" y2="554.375" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="1006" x2="1006" y1="554.375" y2="575.375" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="1006" x2="986" y1="575.375" y2="575.375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1079.5" y="601.375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1079.5">subscribe</tspan></text><line x1="986" x2="1245" y1="606.375" y2="606.375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1295" y="637.375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1295">subscribe</tspan></text><line x1="1245" x2="1417" y1="642.375" y2="642.375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1459" y="673.375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1459">doSubscribe</tspan></text><line x1="1417" x2="1589" y1="678.375" y2="678.375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="1436" y="698.375" width="306" height="45.1875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1441" y="717.375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1441">在ZookeeperRegistry会监听注册中心变化</tspan><tspan dy="1.2em" x="1441">并在此时返回注册中心已有的数据</tspan></text></g><g class="signal"><text x="1361" y="774.5625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1361">refreshInvoker</tspan></text><line x1="1589" x2="1245" y1="779.5625" y2="779.5625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="1092" y="799.5625" width="306" height="64.390625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1097" y="818.5625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1097">经过若干调用后，刷新RegistryDirectory</tspan><tspan dy="1.2em" x="1097">中缓存的Invoker映射表</tspan><tspan dy="1.2em" x="1097">这个映射表也是后续查找服务者的基础</tspan></text></g><g class="signal"><text x="1270" y="896.953125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1270">toInvokers</tspan></text><line x1="1245" x2="1265" y1="883.953125" y2="883.953125" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="1265" x2="1265" y1="883.953125" y2="904.953125" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="1265" x2="1245" y1="904.953125" y2="904.953125" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1478.5" y="930.953125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1478.5">refer</tspan></text><line x1="1245" x2="1752" y1="935.953125" y2="935.953125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="1235" y="955.953125" width="527" height="83.59375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="1240" y="974.953125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1240">由dubbo扩展机制wrapper机制</tspan><tspan dy="1.2em" x="1240">ProtocolFilterWrapper和</tspan><tspan dy="1.2em" x="1240">ProtocolListenerWrapper装饰</tspan><tspan dy="1.2em" x="1240">并构造Filter执行链</tspan></text></g><g class="signal"><text x="1777" y="1072.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1777">initClient</tspan></text><line x1="1752" x2="1772" y1="1059.546875" y2="1059.546875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="1772" x2="1772" y1="1059.546875" y2="1080.546875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="1772" x2="1752" y1="1080.546875" y2="1080.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1790" y="1106.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1790">connect</tspan></text><line x1="1752" x2="1884" y1="1111.546875" y2="1111.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1926" y="1142.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1926">connect</tspan></text><line x1="1884" x2="2024" y1="1147.546875" y2="1147.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="2070" y="1178.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2070">connect</tspan></text><line x1="2024" x2="2172" y1="1183.546875" y2="1183.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="2220" y="1214.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2220">connect</tspan></text><line x1="2172" x2="2324" y1="1219.546875" y2="1219.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="2354" y="1250.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2354">NettyClient</tspan></text><line x1="2324" x2="2472" y1="1255.546875" y2="1255.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="2496" y="1286.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2496">wrapInternal</tspan></text><line x1="2472" x2="2616" y1="1291.546875" y2="1291.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="2462" y="1311.546875" width="164" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="2467" y="1330.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2467">初始化响应处理过程</tspan></text></g><g class="signal"><text x="2497" y="1370.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2497">doOpen</tspan></text><line x1="2472" x2="2492" y1="1357.546875" y2="1357.546875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="2492" x2="2492" y1="1357.546875" y2="1378.546875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="2492" x2="2472" y1="1378.546875" y2="1378.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="2497" y="1406.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2497">doConnect</tspan></text><line x1="2472" x2="2492" y1="1393.546875" y2="1393.546875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="2492" x2="2492" y1="1393.546875" y2="1414.546875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="2492" x2="2472" y1="1414.546875" y2="1414.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="1865" y="1440.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1865">join</tspan></text><line x1="986" x2="2776" y1="1445.546875" y2="1445.546875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="737" y="1465.546875" width="498" height="83.59375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="742" y="1484.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="742">RegistryDirectory缓存Invoker列表</tspan><tspan dy="1.2em" x="742">Cluster$Adapter返回一个调度Invoker列表的Invoker装饰</tspan><tspan dy="1.2em" x="742">Cluster也有wrapper实现：MockClusterWrapper</tspan><tspan dy="1.2em" x="742">因此最终的包裹关系是MockClusterInvoker-AbstractClusterInvoker</tspan></text></g><g class="signal"><text x="1799.5" y="1580.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1799.5">getProxy</tspan></text><line x1="727" x2="2936" y1="1585.140625" y2="1585.140625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="2966" y="1616.140625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2966">add InvokeHandler</tspan></text><line x1="2936" x2="3132" y1="1621.140625" y2="1621.140625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g></svg>